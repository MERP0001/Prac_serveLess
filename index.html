<script>
    // Configuración de la API
    const API_URL = 'https://dcn6y2nrq1.execute-api.us-east-1.amazonaws.com/default/Serveless_practica';

    // Función para cargar reservas
    async function loadReservations() {
        try {
            const response = await fetch(`${API_URL}/reservas`);
            const data = await response.json();
            
            const tbody = document.getElementById('reservationsTableBody');
            tbody.innerHTML = data.map(reservation => `
                <tr>
                    <td>${reservation.id}</td>
                    <td>${reservation.nombre}</td>
                    <td>${reservation.laboratorio}</td>
                    <td>${reservation.fecha}</td>
                </tr>
            `).join('');
        } catch (error) {
            console.error('Error al cargar reservas:', error);
        }
    }

    // Función para crear reserva
    async function createReservation(event) {
        event.preventDefault();
        
        const formData = {
            id: document.getElementById('id').value,
            nombre: document.getElementById('nombre').value,
            correo: document.getElementById('correo').value,
            laboratorio: document.getElementById('laboratorio').value,
            fecha: document.getElementById('fecha').value
        };

        try {
            const response = await fetch(`${API_URL}/reservas`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            
            if (response.ok) {
                alert('Reserva creada exitosamente');
                document.getElementById('reservationForm').reset();
                const modal = bootstrap.Modal.getInstance(document.getElementById('reservationModal'));
                modal.hide();
                loadReservations();
            } else {
                alert(result.error || 'Error al crear la reserva');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al procesar la solicitud');
        }
    }

    // Función para eliminar reserva
    async function deleteReservation(id) {
        if (confirm('¿Está seguro de eliminar esta reserva?')) {
            try {
                const response = await fetch(`${API_URL}/reservas/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Reserva eliminada exitosamente');
                    loadReservations();
                } else {
                    alert('Error al eliminar la reserva');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al procesar la solicitud');
            }
        }
    }

    // Configuración inicial
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar reservas iniciales
        loadReservations();

        // Configurar el formulario
        document.getElementById('reservationForm').addEventListener('submit', createReservation);

        // Configurar restricciones de fecha y hora
        const fechaInput = document.getElementById('fecha');
        const now = new Date();
        const minDate = now.toISOString().split('T')[0];
        fechaInput.min = `${minDate}T08:00`;
    });
</script> 
